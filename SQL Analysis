1. Movies vs TV Shows Count
Find the total number of Movies and TV Shows on Netflix.
SELECT
    type,
    COUNT(*) AS total_titles
FROM netflix_titles
GROUP BY type;

2. Titles Added Per Year
Find how many titles were added to Netflix each year.

SELECT
    YEAR(STR_TO_DATE(date_added, '%M %d, %Y')) AS year_added,
    COUNT(*) AS total_titles
FROM netflix_titles
WHERE date_added IS NOT NULL
GROUP BY year_added
ORDER BY year_added;

3. Top 5 Countries by Total Content
Identify the top 5 countries contributing the most content.

SELECT
    country,
    COUNT(*) AS total_titles
FROM netflix_titles
WHERE country IS NOT NULL
GROUP BY country
ORDER BY total_titles DESC
LIMIT 5;


4. Most Common Ratings on Netflix
Find the most frequently used maturity ratings.

SELECT
    rating,
    COUNT(*) AS total_titles
FROM netflix_titles
WHERE rating IS NOT NULL
GROUP BY rating
ORDER BY total_titles DESC;

5. Average Movie Duration by Release Year
Calculate the average movie duration (in minutes) per year.

SELECT
    release_year,
    ROUND(
        AVG(CAST(SUBSTRING_INDEX(duration, ' ', 1) AS UNSIGNED)),
        2
    ) AS avg_movie_duration_minutes
FROM netflix_titles
WHERE type = 'Movie'
  AND duration LIKE '%min%'
GROUP BY release_year


6. Single-Genre vs Multi-Genre Titles
Compare content with one genre vs multiple genres.

SELECT
    CASE
        WHEN listed_in LIKE '%,%' THEN 'Multi-Genre'
        ELSE 'Single-Genre'
    END AS genre_type,
    COUNT(*) AS total_titles
FROM netflix_titles
GROUP BY genre_type;


7. Year-over-Year Growth Analysis
Calculate YoY percentage growth in number of titles added

WITH yearly_titles AS (
    SELECT 
        YEAR(STR_TO_DATE(date_added, '%M %d, %Y')) AS year_added,
        COUNT(*) AS total_titles
    FROM netflix_titles
    WHERE date_added IS NOT NULL
    GROUP BY year_added
),
yoy_growth AS (
    SELECT
        year_added,
        total_titles,
        LAG(total_titles) OVER (ORDER BY year_added) AS prev_year_titles
    FROM yearly_titles
)
SELECT
    year_added,
    total_titles,
    ROUND(
        ((total_titles - prev_year_titles) / prev_year_titles) * 100,
        2
    ) AS yoy_growth_percentage
FROM yoy_growth
WHERE prev_year_titles IS NOT NULL;


8. Content Dominance by Country
Countries where TV Shows > 40% of total content

SELECT
    country,
    ROUND(
        SUM(CASE WHEN type = 'TV Show' THEN 1 ELSE 0 END) * 100.0 / COUNT(*),
        2
    ) AS tv_show_percentage
FROM netflix_titles
WHERE country IS NOT NULL
GROUP BY country
HAVING tv_show_percentage > 40;


9. Top Genre per Country
Most dominant genre by country


WITH genre_split AS (
    SELECT
        country,
        TRIM(SUBSTRING_INDEX(SUBSTRING_INDEX(listed_in, ',', n.n), ',', -1)) AS genre
    FROM netflix_titles
    JOIN (
        SELECT 1 n UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL
        SELECT 4 UNION ALL SELECT 5
    ) n
    ON CHAR_LENGTH(listed_in) - CHAR_LENGTH(REPLACE(listed_in, ',', '')) >= n.n - 1
    WHERE country IS NOT NULL
),
genre_count AS (
    SELECT
        country,
        genre,
        COUNT(*) AS genre_total,
        RANK() OVER (PARTITION BY country ORDER BY COUNT(*) DESC) AS rnk
    FROM genre_split
    GROUP BY country, genre
)
SELECT
    country,
    genre,
    genre_total
FROM genre_count
WHERE rnk = 1;
